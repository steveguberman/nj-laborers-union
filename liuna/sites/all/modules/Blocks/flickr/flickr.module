<?php
/**
 * @file flickr.module
 *
 * Displays a grid of photo thumbnail links from a Flickr feed.
 */

/**
 * Implementation of hook_block_info()
 */
function flickr_block_info() {
	$blocks['flickr'] = array(
		'info' => t('Display Flickr Feed Thumbnails'),
		'status' => TRUE,
		'region' => 'footer',
		'weight' => 0,
		'visibility' => 1,
	);
	return $blocks;
}

/**
 * Implementation of hook_menu()
 */
function flickr_menu() {
	$items['admin/config/flickr'] = array(
		'title' => 'Flickr',
		'description' => 'Display a grid of thumbnails from a Flickr feed',
		'position' => 'right',
		'weight' => -5,
		'page callback' => 'system_admin_menu_block_page',
		'access arguments' => array('administer site configuration'),
		'file' => 'system.admin.inc',
		'file path' => drupal_get_path('module', 'system'),
	);

	$items['admin/config/flickr/settings'] = array(
		'title' => 'Flickr Feed Settings',
		'description' => 'Flickr Widget Settings',
		'page callback' => 'drupal_get_form',
		'page arguments' => array('flickr_admin_settings'),
		'access arguments' => array('administer site configuration'),
		'type' => MENU_NORMAL_ITEM,
		'file' => 'flickr.admin.inc',
	);

	return $items;
}

/**
 * Implementation of hook_theme()
function flickr_theme() {
	return array(
		'flickr_thumbnail_grid' => array(
			'arguments' => array('items' => NULL),
		),
		'flickr_photo_thumbnail' => array(
			'arguments' => array('item' => NULL),
		),
	);
}
 */
function flickr_theme() {
	return array(
		'flickr_thumbnail_grid' => array(
			'variables' => array('photos' => NULL, 'num_photos' => 16),
			'template' => 'flickr-thumbnail-grid',
		),
	);
}

/**
 * Custom theme functions for rendering parts of the block
function theme_flickr_thumbnail_grid($items) {
	$output = '<ul id="flickr-thumbnail-grid">' . "\n";
	foreach($items['items'] as $item) {
		$output .= "<li class='flickr-thumb'>\n";
		$output .= "\t{$item['description']}\n";
		$output .= "</li>\n";
	}
	$output .= "</ul>";
	return $output;
}
*/
/*
function theme_flickr_photo_thumbnail($item) {
	$output = '<li class="flickr-thumb">' . "\n";
	$output .= <<<END_HTML

END_HTML;
	$output .= '</li>';
	return $output;
}
 */

/**
 * Implementation of hook_block_view()
 */
function flickr_block_view($delta = '') {
	switch ($delta) {
		case 'flickr':
			$block['subject'] = t('Flickr Block');
			$block['content'] = flickr_block_contents($delta);
			return $block;
			break;
	}
}

/**
 * Implementation of hook_block_contents()
 */
function flickr_block_contents($delta) {
	switch ($delta) {
	case 'flickr':
		$feed_url = variable_get('flickr_feed_url', 'http://api.flickr.com/services/feeds/photos_faves.gne?nsid=62751423@N00&lang=en-us&format=php_serial');
		$photo_count = variable_get('flickr_num_photos', 16);
		$flickr_feed = file_get_contents($feed_url);

		if ($feed = unserialize($flickr_feed)) {
			xdebug_break();
			$content = theme('flickr_thumbnail_grid', array('photos' => $feed['items'], 'num_photos' => $photo_count));
			return array('#markup' => $content);
		}

		break;
	}
}

// vim: set ft=php :
?>
